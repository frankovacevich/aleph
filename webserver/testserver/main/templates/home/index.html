{% extends 'base.html' %}
{% load static %}

{% block body %}

<style>

    body{ overflow-x: scroll; color: black; }

    .top-container{ position:absolute;  margin-top: 50px; margin-left: 50px; display: flex; align-items:center; }
    .top-text{ font-size: 24px; font-family: "at_font"; padding-left: 20px; }

    .main-container{ font-size: 16px; display: flex; margin-top: 100px;  margin-left: 50px; }
    .main-container .title{ font-weight: 1000; font-family: "at_font"; margin-bottom: 20px; }
    .main-container .sub-container{ min-width: 300px; padding: 30px 30px 0 0; }

    .item{ padding: 10px 0; display: flex; align-items: center; cursor: pointer; }
    .item .icon{ border-radius: 5px; width: 32px; height: 32px; background-color: gray; font-size: 20px; text-align: center; line-height: 34px; }
    .item .text{ margin-left: 10px; }
    .item:hover{ color: #2399dd; }

    /* For phones */
    @media screen and (max-width: 600px){
        .main-container{ flex-direction: column; margin-top: 30px }
        .top-container{ position: relative; }
        body{ overflow-x: hidden; }
    }

</style>

<!-- Modal -->
<div class="modal fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modal-title">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="modal-description" style="margin-bottom: 10px"></div>
        <div id="modal-params"></div>
      </div>
      <div class="modal-footer">
        <button type="button" id="modal-btn" class="btn btn-primary">Open</button>
      </div>
    </div>
  </div>
</div>


<div class="top-container">
    <div><img src='{% static "res/logo.png" %}' style="width: 48px;"></div>
    <div class="top-text">Aleph Server</div>
</div>

<div class="main-container" id="main-container">

    <!-- 1 -->
    <div class="sub-container">
        <div class="title">General</div>
        <div class="item" onclick="window.location='/explorer'">
            <div class="icon"><i class="icon-tags"></i></div>
            <div class="text">Explorer</div>
        </div>
        <div class="item" onclick="window.location='/admin/'">
            <div class="icon"><i class="icon-user"></i></div>
            <div class="text">Admin</div>
        </div>
        <div class="item" onclick="window.location='/docs/API.html'">
            <div class="icon"><i class="icon-category"></i></div>
            <div class="text">API</div>
        </div>
        <div class="item" onclick="window.location='/docs/'">
            <div class="icon"><i class="icon-question-alt"></i></div>
            <div class="text">Docs</div>
        </div>
         <div class="item" onclick="window.location='/password_change'">
            <div class="icon"><i class="icon-key"></i></div>
            <div class="text">Change password</div>
        </div>
        <div class="item" onclick="window.location='/logout'">
            <div class="icon"><i class="icon-on-off"></i></div>
            <div class="text">Log out</div>
        </div>
    </div>

    {% for g in groups %}
        <div class="sub-container">
        <div class="title">{{ g }}</div>
        {% for r in res %}
            {% if r.group == g %}
                <div class="item" onclick='show_modal("{{ r.i }}")'>
                    <div class="icon"><i class="{{ r.icon }}"></i></div>
                    <div class="text">{{ r.name }}</div>
                </div>
            {% endif %}
        {% endfor %}
        </div>
    {% endfor %}

</div>

<script>

    let jres = JSON.parse('{{ jres|safe }}');

    function show_modal(resource_i){

        let r = jres[resource_i];

        document.getElementById("modal-title").innerHTML = r.name;
        document.getElementById("modal-description").innerHTML = r.description;
        document.getElementById("modal-btn").onclick = function(){ goto(resource_i) };

        let content = "<form><div class='form-group'>";
        for(const p in r.params){
            content += '<label>' + r.params[p] + '</label>';
            content += '<input type="text" id="params-' + p + '" class="form-control">';
        }
        content += "</div></form>";
        document.getElementById("modal-params").innerHTML = content;

        $('#modal').modal('toggle');
    }

    function goto(resource_i){
        let r = jres[resource_i];
        let uri = r.uri + "?";

        for(const p in r.params){
            let v = document.getElementById('params-' + p).value;
            if(v != "") uri += p + "=" + v + "&";
        }
        window.location = uri;
    }

</script>

{% endblock %}
